<!DOCTYPE html>






























<html
  class="not-ready text-sm lg:text-base"
  style="--bg: #faf6f1"
  lang="en-us"
>
  <head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />

  
  <title>Colima 初体验 - Lullaby</title>

  
  <meta name="theme-color" />
  
  <meta name="description" content="背景 很长一段时间以来 Docker Desktop 都无法在线更新，点击更新后图标一直转动，但始终无法更新成功；之前在 Docker 官方社区论坛看到有人讨论过这个问题，至今也没有好的解决方案，基本都是手动下载最新镜像重新安装； Docker 官方社区论坛讨论：Docker Desktop won’t update on MacOS Docker Desktop 资源消耗严重，单 com.docker.hyperkit 进程内存占用超 10G，实际容器占用内存很少，CPU 有时也因占用过多而导致风扇狂转、机器发烫，也比较耗电； 可视化界面有点鸡肋，没有太大作用，而且是用内存大户 Electron 写的，天下苦 Electron 久矣。 介绍 Colima 是基于 Lima 开发的，Lima 基于 QEMU，支持 ARM，M1，Docker，containerd，Kubernetes，端口转发，卷挂载等；
按官方说法：是在 macOS 或 Linux 上所需最少设置的容器运行时。
安装问题 具体安装方法在其 GitHub 主页，这里只列举安装过程可能会遇到的问题：
brew 安装过程中可能会遇到某些依赖包下载不下来，可以多尝试几次，brew 不会全量重新下载，会缓存已下载的包，或者修改 brew 镜像源地址； 中科大镜像源 清华大学开源软件镜像站 阿里云镜像源 启动问题 执行 colima start 时会从 GitHub 拉取 alpine-lima-clm-3.14.6-x86_64.iso 镜像（277.9M），由于国内网络原因始终无法完整的拉取，想着应该可以手动下载并放在指定位置，正准备研究源码时发现了这篇文章 记 mac 下尝鲜 colima 的坎坷经历，作者跟我遇到了一样的问题，于是参考他的方案解决了此问题，在此表示感谢；
参考源码地址
解决方案步骤： 手动下载 alpine-lima-clm-3.14.6-x86_64.iso 镜像； 重命名镜像名字为 basedisk； 将 basedisk 放到 ~/." />
  <meta name="author" content="kopever" />
  

  
  
  
  
  
  
  <link rel="preload stylesheet" as="style" href="https://kopever.com/main.min.css" />

  
  <script
    defer
    src="https://kopever.com/highlight.min.js"
    onload="hljs.initHighlightingOnLoad();"
  ></script>
  

  
  
  
  <link
    rel="preload"
    as="image"
    href="https://kopever.com/theme.png"
  />

  
  
  
  

  
  <link rel="preload" as="image" href="https://kopever.com/twitter.svg" />
  
  <link rel="preload" as="image" href="https://kopever.com/github.svg" />
  
  <link rel="preload" as="image" href="https://kopever.com/instagram.svg" />
  

  
  <link rel="icon" href="https://kopever.com/favicon.ico" />
  <link rel="apple-touch-icon" href="https://kopever.com/apple-touch-icon.png" />

  
  <meta name="generator" content="Hugo 0.104.2" />

  
  

  
  
  
  
  
  
  
  
  
  <meta property="og:title" content="Colima 初体验" />
<meta property="og:description" content="背景 很长一段时间以来 Docker Desktop 都无法在线更新，点击更新后图标一直转动，但始终无法更新成功；之前在 Docker 官方社区论坛看到有人讨论过这个问题，至今也没有好的解决方案，基本都是手动下载最新镜像重新安装； Docker 官方社区论坛讨论：Docker Desktop won’t update on MacOS Docker Desktop 资源消耗严重，单 com.docker.hyperkit 进程内存占用超 10G，实际容器占用内存很少，CPU 有时也因占用过多而导致风扇狂转、机器发烫，也比较耗电； 可视化界面有点鸡肋，没有太大作用，而且是用内存大户 Electron 写的，天下苦 Electron 久矣。 介绍 Colima 是基于 Lima 开发的，Lima 基于 QEMU，支持 ARM，M1，Docker，containerd，Kubernetes，端口转发，卷挂载等；
按官方说法：是在 macOS 或 Linux 上所需最少设置的容器运行时。
安装问题 具体安装方法在其 GitHub 主页，这里只列举安装过程可能会遇到的问题：
brew 安装过程中可能会遇到某些依赖包下载不下来，可以多尝试几次，brew 不会全量重新下载，会缓存已下载的包，或者修改 brew 镜像源地址； 中科大镜像源 清华大学开源软件镜像站 阿里云镜像源 启动问题 执行 colima start 时会从 GitHub 拉取 alpine-lima-clm-3.14.6-x86_64.iso 镜像（277.9M），由于国内网络原因始终无法完整的拉取，想着应该可以手动下载并放在指定位置，正准备研究源码时发现了这篇文章 记 mac 下尝鲜 colima 的坎坷经历，作者跟我遇到了一样的问题，于是参考他的方案解决了此问题，在此表示感谢；
参考源码地址
解决方案步骤： 手动下载 alpine-lima-clm-3.14.6-x86_64.iso 镜像； 重命名镜像名字为 basedisk； 将 basedisk 放到 ~/." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://kopever.com/post/colima-journey/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2022-07-08T00:00:00+00:00" />
<meta property="article:modified_time" content="2022-07-08T00:00:00+00:00" />


  
  <meta itemprop="name" content="Colima 初体验">
<meta itemprop="description" content="背景 很长一段时间以来 Docker Desktop 都无法在线更新，点击更新后图标一直转动，但始终无法更新成功；之前在 Docker 官方社区论坛看到有人讨论过这个问题，至今也没有好的解决方案，基本都是手动下载最新镜像重新安装； Docker 官方社区论坛讨论：Docker Desktop won’t update on MacOS Docker Desktop 资源消耗严重，单 com.docker.hyperkit 进程内存占用超 10G，实际容器占用内存很少，CPU 有时也因占用过多而导致风扇狂转、机器发烫，也比较耗电； 可视化界面有点鸡肋，没有太大作用，而且是用内存大户 Electron 写的，天下苦 Electron 久矣。 介绍 Colima 是基于 Lima 开发的，Lima 基于 QEMU，支持 ARM，M1，Docker，containerd，Kubernetes，端口转发，卷挂载等；
按官方说法：是在 macOS 或 Linux 上所需最少设置的容器运行时。
安装问题 具体安装方法在其 GitHub 主页，这里只列举安装过程可能会遇到的问题：
brew 安装过程中可能会遇到某些依赖包下载不下来，可以多尝试几次，brew 不会全量重新下载，会缓存已下载的包，或者修改 brew 镜像源地址； 中科大镜像源 清华大学开源软件镜像站 阿里云镜像源 启动问题 执行 colima start 时会从 GitHub 拉取 alpine-lima-clm-3.14.6-x86_64.iso 镜像（277.9M），由于国内网络原因始终无法完整的拉取，想着应该可以手动下载并放在指定位置，正准备研究源码时发现了这篇文章 记 mac 下尝鲜 colima 的坎坷经历，作者跟我遇到了一样的问题，于是参考他的方案解决了此问题，在此表示感谢；
参考源码地址
解决方案步骤： 手动下载 alpine-lima-clm-3.14.6-x86_64.iso 镜像； 重命名镜像名字为 basedisk； 将 basedisk 放到 ~/."><meta itemprop="datePublished" content="2022-07-08T00:00:00+00:00" />
<meta itemprop="dateModified" content="2022-07-08T00:00:00+00:00" />
<meta itemprop="wordCount" content="207">
<meta itemprop="keywords" content="" />
  
  <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Colima 初体验"/>
<meta name="twitter:description" content="背景 很长一段时间以来 Docker Desktop 都无法在线更新，点击更新后图标一直转动，但始终无法更新成功；之前在 Docker 官方社区论坛看到有人讨论过这个问题，至今也没有好的解决方案，基本都是手动下载最新镜像重新安装； Docker 官方社区论坛讨论：Docker Desktop won’t update on MacOS Docker Desktop 资源消耗严重，单 com.docker.hyperkit 进程内存占用超 10G，实际容器占用内存很少，CPU 有时也因占用过多而导致风扇狂转、机器发烫，也比较耗电； 可视化界面有点鸡肋，没有太大作用，而且是用内存大户 Electron 写的，天下苦 Electron 久矣。 介绍 Colima 是基于 Lima 开发的，Lima 基于 QEMU，支持 ARM，M1，Docker，containerd，Kubernetes，端口转发，卷挂载等；
按官方说法：是在 macOS 或 Linux 上所需最少设置的容器运行时。
安装问题 具体安装方法在其 GitHub 主页，这里只列举安装过程可能会遇到的问题：
brew 安装过程中可能会遇到某些依赖包下载不下来，可以多尝试几次，brew 不会全量重新下载，会缓存已下载的包，或者修改 brew 镜像源地址； 中科大镜像源 清华大学开源软件镜像站 阿里云镜像源 启动问题 执行 colima start 时会从 GitHub 拉取 alpine-lima-clm-3.14.6-x86_64.iso 镜像（277.9M），由于国内网络原因始终无法完整的拉取，想着应该可以手动下载并放在指定位置，正准备研究源码时发现了这篇文章 记 mac 下尝鲜 colima 的坎坷经历，作者跟我遇到了一样的问题，于是参考他的方案解决了此问题，在此表示感谢；
参考源码地址
解决方案步骤： 手动下载 alpine-lima-clm-3.14.6-x86_64.iso 镜像； 重命名镜像名字为 basedisk； 将 basedisk 放到 ~/."/>

  
  
</head>

  <body class="text-black duration-200 ease-out dark:text-white">
    <header class="mx-auto flex h-[5rem] max-w-3xl px-8 lg:justify-center">
  <div class="relative z-50 mr-auto flex items-center">
    <a class="-translate-x-[1px] -translate-y-0.5 text-3xl font-bold" href="https://kopever.com/"
      >Lullaby</a
    >
    <a
      class="btn-dark ml-6 h-6 w-6 shrink-0 cursor-pointer [background:url(./theme.png)_left_center/_auto_theme('spacing.6')_no-repeat] [transition:_background-position_0.4s_steps(5)] dark:[background-position:right]"
    ></a>
  </div>

  <a
    class="btn-menu relative z-50 -mr-8 flex h-[5rem] w-[5rem] shrink-0 cursor-pointer flex-col items-center justify-center gap-2.5 lg:hidden"
  ></a>

  
  <script>
    
    const htmlClass = document.documentElement.classList;
    setTimeout(() => {
      htmlClass.remove('not-ready');
    }, 10);

    
    const btnMenu = document.querySelector('.btn-menu');
    btnMenu.addEventListener('click', () => {
      htmlClass.toggle('open');
    });

    
    const metaTheme = document.querySelector('meta[name="theme-color"]');
    const lightBg = `"#faf6f1"`.replace(/"/g, '');
    const setDark = (isDark) => {
      metaTheme.setAttribute('content', isDark ? '#000' : lightBg);
      htmlClass[isDark ? 'add' : 'remove']('dark');
      localStorage.setItem('dark', isDark);
    };

    
    const darkScheme = window.matchMedia('(prefers-color-scheme: dark)');
    const darkVal = localStorage.getItem('dark');
    setDark(darkVal ? darkVal === 'true' : darkScheme.matches);

    
    darkScheme.addEventListener('change', (event) => {
      setDark(event.matches);
    });

    
    const btnDark = document.querySelector('.btn-dark');
    btnDark.addEventListener('click', () => {
      setDark(localStorage.getItem('dark') !== 'true');
    });
  </script>

  <div
    class="nav-wrapper fixed inset-x-0 top-full z-40 flex h-full select-none flex-col justify-center pb-16 duration-200 dark:bg-black lg:static lg:h-auto lg:flex-row lg:!bg-transparent lg:pb-0 lg:transition-none"
  >
    
    
    <nav class="lg:ml-12 lg:flex lg:flex-row lg:items-center lg:space-x-6">
      
      <a
        class="block text-center text-2xl leading-[5rem] lg:text-base lg:font-normal"
        href="/about/"
        >About</a
      >
      
    </nav>
    

    
    <nav
      class="mt-12 flex justify-center space-x-10 dark:invert lg:mt-0 lg:ml-12 lg:items-center lg:space-x-6"
    >
      
      <a
        class="h-8 w-8 [background:var(--url)_center_center/cover_no-repeat] lg:h-6 lg:w-6"
        style="--url: url(./twitter.svg)"
        href=" https://twitter.com/kopstill "
        target="_blank"
      ></a>
      
      <a
        class="h-8 w-8 [background:var(--url)_center_center/cover_no-repeat] lg:h-6 lg:w-6"
        style="--url: url(./github.svg)"
        href=" https://github.com/kopstill "
        target="_blank"
      ></a>
      
      <a
        class="h-8 w-8 [background:var(--url)_center_center/cover_no-repeat] lg:h-6 lg:w-6"
        style="--url: url(./instagram.svg)"
        href=" https://instagram.com/kopstill "
        target="_blank"
      ></a>
      
    </nav>
    
  </div>
</header>


    <main
      class="prose prose-neutral relative mx-auto min-h-[calc(100%-10rem)] max-w-3xl px-8 pt-20 pb-32 dark:prose-invert"
    >
      

<article>
  <header class="mb-20">
    <h1 class="!my-0 pb-2.5">Colima 初体验</h1>

    
    <div class="text-sm opacity-60">
      
      <time>Jul 8, 2022</time>
      
      
      <span class="mx-1">&middot;</span>
      <span>kopever</span>
      
    </div>
    
  </header>

  <section><h3 id="背景">背景</h3>
<ol>
<li>很长一段时间以来 Docker Desktop 都无法在线更新，点击更新后图标一直转动，但始终无法更新成功；之前在 Docker 官方社区论坛看到有人讨论过这个问题，至今也没有好的解决方案，基本都是手动下载最新镜像重新安装；
<ul>
<li>Docker 官方社区论坛讨论：<a href="https://forums.docker.com/t/docker-desktop-wont-update-on-macos/114648" target="_blank">Docker Desktop won’t update on MacOS</a></li>
</ul>
</li>
<li>Docker Desktop 资源消耗严重，单 com.docker.hyperkit 进程内存占用超 10G，实际容器占用内存很少，CPU 有时也因占用过多而导致风扇狂转、机器发烫，也比较耗电；</li>
<li>可视化界面有点鸡肋，没有太大作用，而且是用内存大户 Electron 写的，天下苦 Electron 久矣。</li>
</ol>
<h3 id="介绍">介绍</h3>
<p><a href="https://github.com/abiosoft/colima" target="_blank">Colima</a> 是基于 <a href="https://github.com/lima-vm/lima" target="_blank">Lima</a> 开发的，Lima 基于 <a href="https://github.com/qemu/qemu" target="_blank">QEMU</a>，支持 ARM，M1，Docker，containerd，Kubernetes，端口转发，卷挂载等；<br>
按官方说法：是在 macOS 或 Linux 上所需最少设置的容器运行时。</p>
<h3 id="安装问题">安装问题</h3>
<p>具体安装方法在其 <a href="https://github.com/abiosoft/colima" target="_blank">GitHub</a> 主页，这里只列举安装过程可能会遇到的问题：</p>
<ol>
<li>brew 安装过程中可能会遇到某些依赖包下载不下来，可以多尝试几次，brew 不会全量重新下载，会缓存已下载的包，或者修改 brew 镜像源地址；
<ul>
<li><a href="https://mirrors.ustc.edu.cn/help/brew.git.html" target="_blank">中科大镜像源</a></li>
<li><a href="https://mirrors.tuna.tsinghua.edu.cn/help/homebrew/" target="_blank">清华大学开源软件镜像站</a></li>
<li><a href="https://developer.aliyun.com/mirror/homebrew" target="_blank">阿里云镜像源</a></li>
</ul>
</li>
</ol>
<h3 id="启动问题">启动问题</h3>
<ol>
<li>执行 colima start 时会从 GitHub 拉取 <a href="https://github.com/abiosoft/alpine-lima/releases/download/colima-v0.4.2-1/alpine-lima-clm-3.14.6-x86_64.iso" target="_blank">alpine-lima-clm-3.14.6-x86_64.iso</a> 镜像（277.9M），由于国内网络原因始终无法完整的拉取，想着应该可以手动下载并放在指定位置，正准备研究源码时发现了这篇文章 <a href="https://stanzhai.site/blog/post/stanzhai/%E8%A7%A3%E5%86%B3mac%E4%B8%8B%E4%BD%BF%E7%94%A8brew%E7%BC%96%E8%AF%91%E5%AE%89%E8%A3%85colima%E6%8A%A5%E9%94%99%E7%9A%84%E9%97%AE%E9%A2%98" target="_blank">记 mac 下尝鲜 colima 的坎坷经历</a>，作者跟我遇到了一样的问题，于是参考他的方案解决了此问题，在此表示感谢；<br>
<a href="https://github.com/lima-vm/lima/blob/44454dd1285a0baba13ec0538f1f1b37b31160d5/pkg/qemu/qemu.go#L77" target="_blank">参考源码地址</a><br>
<strong>解决方案步骤：</strong>
<ul>
<li>手动下载 <a href="https://github.com/abiosoft/alpine-lima/releases/download/colima-v0.4.2-1/alpine-lima-clm-3.14.6-x86_64.iso" target="_blank">alpine-lima-clm-3.14.6-x86_64.iso</a> 镜像；</li>
<li>重命名镜像名字为 basedisk；</li>
<li>将 basedisk 放到 ~/.lima/colima/ 目录下。</li>
</ul>
</li>
</ol>
<h3 id="挂载问题">挂载问题</h3>
<p>启动 mysql 容器：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>docker run -p 3306:3306 --name mysql <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    -v ~/docker/data/mysql:/var/lib/mysql <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    -e MYSQL_ROOT_PASSWORD<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;TNZSV4dA**b@ZK58Eez$3hYsfhM@6Kx#&#39;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    -d mysql:latest
</span></span></code></pre></div><p>出现以下错误：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>chown: changing ownership of <span style="color:#e6db74">&#39;/var/lib/mysql&#39;</span>: Permission denied
</span></span></code></pre></div><ol>
<li>Colima / Lima 支持 sshfs 和 9p 两种挂载方式，默认 sshfs 不支持容器目录挂载，9p 支持虚拟机目录可被操作系统作为文件目录直接访问，具体参见 <a href="https://wiki.qemu.org/Documentation/9psetup" target="_blank">Documentation/9psetup</a>，可在 Colima 启动时指定挂载方式，建议启动前先删除已创建的 Colima 实例；</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>colima stop
</span></span><span style="display:flex;"><span>colima delete
</span></span><span style="display:flex;"><span>colima start --mount-type 9p
</span></span></code></pre></div><p><strong>注意事项：</strong></p>
<ul>
<li><a href="https://github.com/lima-vm/lima/releases/tag/v0.10.0" target="_blank">Lima v0.10.0</a> 开始支持 9p，并计划在 v1.0 中将 9p 作为默认挂载方式；</li>
<li><a href="https://github.com/abiosoft/colima/releases/tag/v0.4.0" target="_blank">Colima v0.4.0</a> 开始支持 9p 及 mount-type 参数，并可通过 colima status 查看当前挂载方式；</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>colima status
</span></span><span style="display:flex;"><span>INFO<span style="color:#f92672">[</span>0000<span style="color:#f92672">]</span> colima is running
</span></span><span style="display:flex;"><span>INFO<span style="color:#f92672">[</span>0000<span style="color:#f92672">]</span> arch: x86_64
</span></span><span style="display:flex;"><span>INFO<span style="color:#f92672">[</span>0000<span style="color:#f92672">]</span> runtime: docker
</span></span><span style="display:flex;"><span>INFO<span style="color:#f92672">[</span>0000<span style="color:#f92672">]</span> mountType: 9p
</span></span><span style="display:flex;"><span>INFO<span style="color:#f92672">[</span>0000<span style="color:#f92672">]</span> socket: unix:///Users/username/.colima/default/docker.sock
</span></span></code></pre></div><ul>
<li>Lima 配置文件目录：~/.lima/colima/lima.yaml</li>
<li>Colima 配置文件目录：~/.colima/default/colima.yaml</li>
</ul>
<h3 id="使用问题">使用问题</h3>
<ol>
<li>使用 docker-compose（需手动安装 brew install docker-compose）时遇到错误：<br>
error getting credentials - err: exec: &ldquo;docker-credential-desktop&rdquo;: executable file not found in $PATH<br>
参考此 GitHub Issue <a href="https://github.com/abiosoft/colima/issues/265" target="_blank">Unable to use docker-compose / docker compose with colima</a>；<br>
<strong>解决方案：</strong>
<ul>
<li>将 ~/.docker/config.json 文件中的 credsStore 改为 credStore。</li>
</ul>
</li>
</ol>
</section>

  
  

  
  
  
  <nav class="mt-24 flex rounded-lg bg-black/[3%] text-lg dark:bg-white/[8%]">
    
    
    <a
      class="ml-auto flex w-1/2 items-center justify-end p-6 pl-3 no-underline"
      href="https://kopever.com/post/shadowsocks-server/"
      ><span>Shadowsocks 服务端教程</span><span class="ml-1.5">→</span></a
    >
    
  </nav>
  

  
  
</article>


    </main>

    <footer class="opaco mx-auto flex h-[5rem] max-w-3xl items-center px-8 text-[0.9em] opacity-60">
  <div class="mr-auto">
    &copy; 2022
    <a class="link" href="https://kopever.com/">Lullaby</a>
  </div>
  <a class="link mx-6" href="https://gohugo.io/" rel="noopener" target="_blank">Powered by Hugo️️</a
  >️
  <a class="link" href="https://github.com/nanxiaobei/hugo-paper" rel="noopener" target="_blank"
    >▷ Paper 6</a
  >
</footer>

  </body>
</html>
